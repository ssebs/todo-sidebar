<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="Content-Security-Policy" content="default-src 'none'; style-src {{cspSource}} 'unsafe-inline'; script-src 'nonce-{{nonce}}';">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Welcome to Todo Sidebar</title>
  <style>
    body {
      padding: 20px;
      font-family: var(--vscode-font-family);
      font-size: var(--vscode-font-size);
      color: var(--vscode-foreground);
      background: var(--vscode-sideBar-background);
      max-width: 100%;
    }
    .wizard {
      display: flex;
      flex-direction: column;
      gap: 24px;
    }
    .wizard-header {
      text-align: center;
      margin-bottom: 8px;
    }
    .wizard-title {
      font-size: 1.5em;
      font-weight: bold;
      margin: 0 0 8px 0;
      color: var(--vscode-foreground);
    }
    .wizard-subtitle {
      font-size: 0.95em;
      color: var(--vscode-descriptionForeground);
      margin: 0;
    }
    .wizard-section {
      background: var(--vscode-editor-background);
      border: 1px solid var(--vscode-panel-border);
      border-radius: 6px;
      padding: 16px;
    }
    .section-title {
      font-size: 1.1em;
      font-weight: 600;
      margin: 0 0 12px 0;
      color: var(--vscode-foreground);
    }
    .section-description {
      font-size: 0.9em;
      color: var(--vscode-descriptionForeground);
      margin: 0 0 12px 0;
      line-height: 1.5;
    }
    .file-select-btn {
      display: block;
      width: 100%;
      padding: 10px 16px;
      background: var(--vscode-button-background);
      color: var(--vscode-button-foreground);
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.95em;
      font-weight: 500;
      text-align: center;
    }
    .file-select-btn:hover {
      background: var(--vscode-button-hoverBackground);
    }
    .file-select-btn:active {
      background: var(--vscode-button-hoverBackground);
      opacity: 0.9;
    }
    .selected-file {
      margin-top: 8px;
      padding: 8px 12px;
      background: var(--vscode-input-background);
      border: 1px solid var(--vscode-input-border);
      border-radius: 3px;
      font-size: 0.9em;
      color: var(--vscode-foreground);
      word-break: break-all;
    }
    .selected-file.empty {
      color: var(--vscode-descriptionForeground);
      font-style: italic;
    }
    .radio-group {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .radio-option {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      padding: 12px;
      background: var(--vscode-input-background);
      border: 1px solid var(--vscode-input-border);
      border-radius: 4px;
      cursor: pointer;
      transition: border-color 0.2s;
    }
    .radio-option:hover {
      border-color: var(--vscode-focusBorder);
    }
    .radio-option.selected {
      border-color: var(--vscode-focusBorder);
      background: var(--vscode-list-hoverBackground);
    }
    .radio-option input[type="radio"] {
      margin-top: 2px;
      cursor: pointer;
    }
    .radio-label {
      flex: 1;
      cursor: pointer;
    }
    .radio-label-title {
      font-weight: 600;
      margin-bottom: 4px;
      color: var(--vscode-foreground);
    }
    .radio-label-description {
      font-size: 0.85em;
      color: var(--vscode-descriptionForeground);
      line-height: 1.4;
    }
    .tips-section {
      background: var(--vscode-textBlockQuote-background);
      border-left: 4px solid var(--vscode-textBlockQuote-border);
      padding: 12px 16px;
      border-radius: 4px;
    }
    .tips-title {
      font-size: 1em;
      font-weight: 600;
      margin: 0 0 10px 0;
      color: var(--vscode-foreground);
    }
    .tips-list {
      margin: 0;
      padding-left: 20px;
      color: var(--vscode-foreground);
    }
    .tips-list li {
      margin-bottom: 8px;
      line-height: 1.5;
    }
    .tips-list li:last-child {
      margin-bottom: 0;
    }
    .tips-code {
      background: var(--vscode-textCodeBlock-background);
      padding: 2px 6px;
      border-radius: 3px;
      font-family: var(--vscode-editor-font-family);
      font-size: 0.9em;
    }
    .wizard-footer {
      display: flex;
      gap: 12px;
      margin-top: 8px;
    }
    .save-btn {
      flex: 1;
      padding: 12px 16px;
      background: var(--vscode-button-background);
      color: var(--vscode-button-foreground);
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 1em;
      font-weight: 600;
    }
    .save-btn:hover:not(:disabled) {
      background: var(--vscode-button-hoverBackground);
    }
    .save-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .cancel-btn {
      padding: 12px 16px;
      background: var(--vscode-button-secondaryBackground);
      color: var(--vscode-button-secondaryForeground);
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 1em;
    }
    .cancel-btn:hover {
      background: var(--vscode-button-secondaryHoverBackground);
    }
    .error-message {
      margin-top: 8px;
      padding: 8px 12px;
      background: var(--vscode-inputValidation-errorBackground);
      border: 1px solid var(--vscode-inputValidation-errorBorder);
      color: var(--vscode-errorForeground);
      border-radius: 3px;
      font-size: 0.9em;
    }
  </style>
</head>
<body>
  <div class="wizard">
    <div class="wizard-header">
      <h1 class="wizard-title">Welcome to Todo Sidebar!</h1>
      <p class="wizard-subtitle">Let's set up your Kanban-style todo board</p>
    </div>

    <!-- Step 1: Choose a markdown file -->
    <div class="wizard-section">
      <h2 class="section-title">1. Choose a Markdown File</h2>
      <p class="section-description">
        Select a markdown file to use as your todo board. You can use an existing file or create a new one.
      </p>
      <button class="file-select-btn" id="selectFileBtn">Select Markdown File</button>
      <div class="selected-file empty" id="selectedFile">No file selected</div>
    </div>

    <!-- Step 2: Choose onDoneAction setting -->
    <div class="wizard-section">
      <h2 class="section-title">2. Choose Done Task Behavior</h2>
      <p class="section-description">
        What should happen when you check off a top-level task?
      </p>
      <div class="radio-group">
        <label class="radio-option selected" data-value="move">
          <input type="radio" name="onDoneAction" value="move" checked>
          <div class="radio-label">
            <div class="radio-label-title">Move to Done Column (Recommended)</div>
            <div class="radio-label-description">
              When you check a task, it toggles to [x] and moves to the "Done" column at the top. Great for tracking completed work.
            </div>
          </div>
        </label>
        <label class="radio-option" data-value="delete">
          <input type="radio" name="onDoneAction" value="delete">
          <div class="radio-label">
            <div class="radio-label-title">Delete Immediately</div>
            <div class="radio-label-description">
              When you check a task, it's deleted immediately (no confirmation). Use this if you don't need to track completed tasks. Undo with Ctrl+Z if needed.
            </div>
          </div>
        </label>
      </div>
    </div>

    <!-- Step 3: Tips section (easily editable) -->
    <div class="wizard-section">
      <div class="tips-section" id="tipsSection">
        <!-- Tips content is loaded from tips.html -->
      </div>
    </div>

    <!-- Footer with action buttons -->
    <div class="wizard-footer">
      <button class="cancel-btn" id="cancelBtn">Skip Setup</button>
      <button class="save-btn" id="saveBtn" disabled>Save and Get Started</button>
    </div>
    <div class="error-message" id="errorMessage" style="display: none;"></div>
  </div>

  <script nonce="{{nonce}}">
    const vscode = acquireVsCodeApi();

    let selectedFilePath = null;
    let selectedOnDoneAction = 'move';

    // Load tips content
    const tipsContent = `{{TIPS_CONTENT}}`;
    document.getElementById('tipsSection').innerHTML = tipsContent;

    // File selection
    document.getElementById('selectFileBtn').addEventListener('click', () => {
      vscode.postMessage({ type: 'selectFile' });
    });

    // Radio button selection
    document.querySelectorAll('.radio-option').forEach(option => {
      option.addEventListener('click', () => {
        // Update radio input
        const radio = option.querySelector('input[type="radio"]');
        radio.checked = true;
        selectedOnDoneAction = radio.value;

        // Update visual selection
        document.querySelectorAll('.radio-option').forEach(opt => {
          opt.classList.remove('selected');
        });
        option.classList.add('selected');
      });
    });

    // Save button
    document.getElementById('saveBtn').addEventListener('click', () => {
      if (!selectedFilePath) {
        showError('Please select a markdown file first');
        return;
      }

      vscode.postMessage({
        type: 'saveWizard',
        filePath: selectedFilePath,
        onDoneAction: selectedOnDoneAction
      });
    });

    // Cancel button
    document.getElementById('cancelBtn').addEventListener('click', () => {
      vscode.postMessage({ type: 'cancelWizard' });
    });

    // Handle messages from extension
    window.addEventListener('message', (event) => {
      const message = event.data;

      if (message.type === 'fileSelected') {
        selectedFilePath = message.filePath;
        const fileDisplay = document.getElementById('selectedFile');
        fileDisplay.textContent = message.filePath;
        fileDisplay.classList.remove('empty');

        // Enable save button
        document.getElementById('saveBtn').disabled = false;

        // Hide error if shown
        document.getElementById('errorMessage').style.display = 'none';
      } else if (message.type === 'error') {
        showError(message.message);
      }
    });

    function showError(message) {
      const errorEl = document.getElementById('errorMessage');
      errorEl.textContent = message;
      errorEl.style.display = 'block';
    }
  </script>
</body>
</html>
