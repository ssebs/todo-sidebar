(()=>{"use strict";var e={265(e,n,t){var i,o=this&&this.__createBinding||(Object.create?function(e,n,t,i){void 0===i&&(i=t);var o=Object.getOwnPropertyDescriptor(n,t);o&&!("get"in o?!n.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,i,o)}:function(e,n,t,i){void 0===i&&(i=t),e[i]=n[t]}),s=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),a=this&&this.__importStar||(i=function(e){return i=Object.getOwnPropertyNames||function(e){var n=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[n.length]=t);return n},i(e)},function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t=i(e),a=0;a<t.length;a++)"default"!==t[a]&&o(n,e,t[a]);return s(n,e),n});Object.defineProperty(n,"__esModule",{value:!0}),n.activate=function(e){console.log("Todo Sidebar extension is now active!"),l=new c.KanbanViewProvider(e),e.subscriptions.push(r.window.registerWebviewViewProvider(c.KanbanViewProvider.viewType,l));const n=r.commands.registerCommand("todoSidebar.openFile",async()=>{const e=await r.window.showOpenDialog({canSelectFiles:!0,canSelectFolders:!1,canSelectMany:!1,filters:{Markdown:["md"]},title:"Select a Markdown file for the Todo Board"});e&&e[0]&&(await l.setActiveFile(e[0]),r.window.showInformationMessage(`Loaded: ${e[0].fsPath}`))}),t=r.commands.registerCommand("todoSidebar.refresh",async()=>{await l.refresh()});e.subscriptions.push(n,t)},n.deactivate=function(){l&&l.dispose()};const r=a(t(398)),c=t(913);let l},337(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.parseMarkdown=function(e){const n=e.replace(/\r\n/g,"\n").replace(/\r/g,"\n").split("\n"),t={title:"",description:"",columns:[]};let i=null,o=[],s=!1;for(let e=0;e<n.length;e++){const a=n[e],r=e+1;if(!s){const e=a.match(/^#\s+([^#].*)$/);if(e){t.title=e[1].trim();continue}const n=a.match(/^>\s*(.*)$/);if(n){t.description?t.description+="\n"+n[1]:t.description=n[1];continue}}const c=a.match(/^##\s+(.+)$/);if(c){s=!0;const e=c[1].trim();i={title:e,line:r,isDoneColumn:e.toLowerCase().includes("done"),tasks:[]},t.columns.push(i),o=[];continue}const l=a.match(/^(\s*)[-*]\s+\[([ xX])\]\s+(.+)$/);if(l&&i){const e=l[1].length,n="x"===l[2].toLowerCase(),t={text:l[3].trim(),checked:n,line:r,children:[],hasCheckbox:!0};for(;o.length>0&&o[o.length-1].indent>=e;)o.pop();o.length>0?o[o.length-1].task.children.push(t):i.tasks.push(t),o.push({task:t,indent:e});continue}const d=a.match(/^(\s*)[-*]\s+([☐☑✓✗])\s+(.+)$/);if(d&&i){const e=d[1].length,n=d[2],t="☑"===n||"✓"===n,s={text:d[3].trim(),checked:t,line:r,children:[],hasCheckbox:!0};for(;o.length>0&&o[o.length-1].indent>=e;)o.pop();o.length>0?o[o.length-1].task.children.push(s):i.tasks.push(s),o.push({task:s,indent:e});continue}const p=a.match(/^(\s*)[-*]\s+>\s*(.+)$/);if(p&&o.length>0){const e={text:p[2].trim(),checked:!1,line:r,children:[],hasCheckbox:!1};o[o.length-1].task.children.push(e);continue}const u=a.match(/^(\s+)[-*]\s+(.+)$/);if(u&&o.length>0){const e=u[1].length,n=u[2].trim();if(n.match(/^\[[ xX]\]/)||n.match(/^[☐☑✓✗]/))continue;const t={text:n,checked:!1,line:r,children:[],hasCheckbox:!1};for(;o.length>1&&o[o.length-1].indent>=e;)o.pop();o.length>0&&o[o.length-1].task.children.push(t)}}return t}},398(e){e.exports=require("vscode")},522(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.toggleTaskInContent=function(e,n,t){const i=e.includes("\r\n")?"\r\n":"\n",o=e.split(/\r?\n/),s=n-1;if(s>=0&&s<o.length){const e=o[s];if(t){let n=e.replace(/([-*]\s+)\[ \]/,"$1[x]");n=n.replace(/([-*]\s+)☐/,"$1☑"),o[s]=n}else{let n=e.replace(/([-*]\s+)\[[xX]\]/,"$1[ ]");n=n.replace(/([-*]\s+)[☑✓]/,"$1☐"),o[s]=n}}return o.join(i)},n.moveTaskInContent=function(e,n,t,i="bottom",o){const s=e.includes("\r\n")?"\r\n":"\n",a=e.split(/\r?\n/),r=n-1,c=[],l=a[r]?.match(/^(\s*)/)?.[1].length??0;c.push(a[r]);let d=r+1;for(;d<a.length;){const e=a[d],n=e.match(/^(\s*)/)?.[1].length??0;if(""===e.trim())break;if(n<=l&&""!==e.trim())break;c.push(e),d++}const p=c.map(e=>e.startsWith(" ".repeat(l))?e.slice(l):e),u=[...a.slice(0,r),...a.slice(r+c.length)];let h=-1,f=o;void 0!==o&&n<o&&(f=o-c.length);for(let e=0;e<u.length;e++){const n=u[e].match(/^##\s+(.+)$/);if(n){const o=n[1].trim();if(o===t||o.startsWith(t)){if("top"===i){let n=e+1;for(;n<u.length&&""===u[n].trim();)n++;h=n}else if("after"===i&&void 0!==f){const e=f-1;if(e>=0&&e<u.length){const n=u[e]?.match(/^(\s*)/)?.[1].length??0;let t=e+1;for(;t<u.length;){const e=u[t],i=e.match(/^(\s*)/)?.[1].length??0;if(""===e.trim()||i<=n)break;t++}h=t}}else{let n=e+1;for(;n<u.length&&!u[n].match(/^##\s+/);)n++;h=n}break}}}if(-1===h)return e;const g=[...u.slice(0,h),...p,"",...u.slice(h)],v=[];let m=!1;for(const e of g){const n=""===e.trim();n&&m||(v.push(e),m=n)}return v.join(s)},n.moveTaskToParent=function(e,n,t,i="bottom",o){const s=e.includes("\r\n")?"\r\n":"\n",a=e.split(/\r?\n/),r=n-1,c=t-1,l=a[r];if(!l)return e;const d=l.match(/^\s*[-*]\s+(\[[ xX]\]|[☐☑✓✗])?\s*(.+)$/);if(!d)return e;const p=d[1]||"[ ]",u=d[2],h=a[c];if(!h)return e;const f=h.match(/^(\s*)/)?.[1].length??0,g=" ".repeat(f+2),v=[],m=l.match(/^(\s*)/)?.[1].length??0;v.push(`${g}- ${p} ${u}`);let k=r+1;for(;k<a.length;){const e=a[k],n=e.match(/^(\s*)/)?.[1].length??0;if(""===e.trim())break;if(n<=m&&""!==e.trim())break;const t=e.match(/^(\s*)(.+)$/);if(t){const e=" ".repeat(f+2+(n-m));v.push(`${e}${t[2]}`)}k++}const b=k-r;let x=c;r<c&&(x=c-b);const w=[...a.slice(0,r),...a.slice(r+b)];let y;const _=w[x],S=_?.match(/^(\s*)/)?.[1].length??0;if("top"===i)y=x+1;else if("after"===i&&void 0!==o){let e=o;r<o&&(e=o-b);const n=e-1;if(n>=0&&n<w.length){const e=w[n]?.match(/^(\s*)/)?.[1].length??0;for(y=n+1;y<w.length;){const n=w[y],t=n.match(/^(\s*)/)?.[1].length??0;if(""===n.trim()||t<=e)break;y++}}else y=x+1}else for(y=x+1;y<w.length;){const e=w[y],n=e.match(/^(\s*)/)?.[1].length??0;if(""===e.trim())break;if(n<=S)break;y++}const T=[...w.slice(0,y),...v,...w.slice(y)],L=[];let E=!1;for(const e of T){const n=""===e.trim();n&&E||(L.push(e),E=n)}return L.join(s)},n.addTaskToSection=function(e,n){const t=e.includes("\r\n")?"\r\n":"\n",i=e.split(/\r?\n/);let o=-1;for(let e=0;e<i.length;e++){const t=i[e].match(/^##\s+(.+)$/);if(t&&t[1].trim()===n){o=e;break}}if(-1===o)return{content:e,line:-1};let s=o+1;for(;s<i.length&&""===i[s].trim();)s++;return i.splice(s,0,"- [ ] New task"),{content:i.join(t),line:s+1}},n.editTaskTextInContent=function(e,n,t){const i=e.includes("\r\n")?"\r\n":"\n",o=e.split(/\r?\n/),s=n-1;if(s<0||s>=o.length)return e;const a=o[s],r=a.match(/^(\s*[-*]\s+\[[ xX]\]\s+)(.+)$/);if(r)return o[s]=r[1]+t,o.join(i);const c=a.match(/^(\s*[-*]\s+[☐☑✓✗]\s+)(.+)$/);return c?(o[s]=c[1]+t,o.join(i)):e},n.addSubtaskToParent=function(e,n){const t=e.includes("\r\n")?"\r\n":"\n",i=e.split(/\r?\n/),o=n-1;if(o<0||o>=i.length)return{content:e,line:-1};const s=i[o],a=s.match(/^(\s*)/)?.[1].length??0,r=" ".repeat(a+2);let c=o+1;for(;c<i.length;){const e=i[c],n=e.match(/^(\s*)/)?.[1].length??0;if(""===e.trim())break;if(n<=a)break;c++}const l=`${r}- [ ] New task`;return i.splice(c,0,l),{content:i.join(t),line:c+1}},n.removeCheckboxFromTask=function(e,n){const t=e.includes("\r\n")?"\r\n":"\n",i=e.split(/\r?\n/),o=n-1;if(o<0||o>=i.length)return e;const s=i[o],a=s.match(/^(\s*[-*]\s+)\[[ xX]\]\s+(.+)$/);if(a)return i[o]=a[1]+a[2],i.join(t);const r=s.match(/^(\s*[-*]\s+)[☐☑✓✗]\s+(.+)$/);return r?(i[o]=r[1]+r[2],i.join(t)):e}},913(e,n,t){var i,o=this&&this.__createBinding||(Object.create?function(e,n,t,i){void 0===i&&(i=t);var o=Object.getOwnPropertyDescriptor(n,t);o&&!("get"in o?!n.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,i,o)}:function(e,n,t,i){void 0===i&&(i=t),e[i]=n[t]}),s=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),a=this&&this.__importStar||(i=function(e){return i=Object.getOwnPropertyNames||function(e){var n=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[n.length]=t);return n},i(e)},function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t=i(e),a=0;a<t.length;a++)"default"!==t[a]&&o(n,e,t[a]);return s(n,e),n});Object.defineProperty(n,"__esModule",{value:!0}),n.KanbanViewProvider=void 0;const r=a(t(398)),c=t(337),l=t(522);n.KanbanViewProvider=class{_context;static viewType="todoSidebar.kanbanView";_view;_activeFileUri;_board;_disposables=[];_pendingEditLine;constructor(e){this._context=e}resolveWebviewView(e,n,t){if(this._view=e,e.webview.options={enableScripts:!0,localResourceRoots:[this._context.extensionUri]},e.webview.html=this._getHtmlForWebview(e.webview),e.webview.onDidReceiveMessage(async e=>{switch(e.type){case"toggle":await this._handleToggle(e.line,e.checked,e.targetColumn);break;case"move":await this._handleMove(e.taskLine,e.targetSection,e.position,e.afterLine);break;case"openAtLine":await this._handleOpenAtLine(e.line);break;case"getColumns":this._board&&this._view?.webview.postMessage({type:"columnsForPicker",columns:this._board.columns.map(e=>({title:e.title,isDoneColumn:e.isDoneColumn})),taskLine:e.line});break;case"moveToParent":await this._handleMoveToParent(e.taskLine,e.parentLine,e.position,e.afterLine);break;case"addTask":await this._handleAddTask(e.section);break;case"editTaskText":await this._handleEditTaskText(e.line,e.newText);break;case"addSubtask":await this._handleAddSubtask(e.parentLine)}}),0===this._disposables.length&&this._setupFileWatchers(),!this._activeFileUri){const e=this._context.workspaceState.get("todoSidebar.activeFile");if(e)try{this._activeFileUri=r.Uri.file(e)}catch(e){console.error("Failed to restore saved file:",e)}}this._activeFileUri&&this._refresh()}_setupFileWatchers(){this._disposables.push(r.workspace.onDidChangeTextDocument(e=>{this._activeFileUri&&e.document.uri.toString()===this._activeFileUri.toString()&&this._refresh()}));const e=r.workspace.createFileSystemWatcher("**/*.md");this._disposables.push(e.onDidChange(e=>{this._activeFileUri&&e.toString()===this._activeFileUri.toString()&&this._refresh()})),this._disposables.push(e)}async setActiveFile(e){this._activeFileUri=e,await this._context.workspaceState.update("todoSidebar.activeFile",e.fsPath),await this._refresh()}async refresh(){await this._refresh()}async _refresh(){if(this._activeFileUri&&this._view)try{const e=await r.workspace.fs.readFile(this._activeFileUri),n=Buffer.from(e).toString("utf-8");this._board=(0,c.parseMarkdown)(n);const t=this._pendingEditLine;this._pendingEditLine=void 0,this._view.webview.postMessage({type:"update",board:this._board,editLine:t})}catch(e){console.error("Error refreshing kanban board:",e)}}async _handleToggle(e,n,t){if(this._activeFileUri&&this._board)try{const i=await r.workspace.fs.readFile(this._activeFileUri);let o=Buffer.from(i).toString("utf-8");o=(0,l.toggleTaskInContent)(o,e,n);const s=this._isTopLevelTask(e);if(n&&s){const n=this._board.columns.find(e=>e.isDoneColumn);if(n){const t=this._findTaskColumn(e);t&&!t.isDoneColumn&&(o=(0,l.moveTaskInContent)(o,e,n.title,"top"))}}else t&&s&&(o=(0,l.moveTaskInContent)(o,e,t,"top"));await r.workspace.fs.writeFile(this._activeFileUri,Buffer.from(o,"utf-8"))}catch(e){console.error("Error toggling task:",e)}}_isTopLevelTask(e){if(!this._board)return!1;for(const n of this._board.columns)for(const t of n.tasks)if(t.line===e)return!0;return!1}_findTaskColumn(e){if(!this._board)return;const n=t=>{for(const i of t){if(i.line===e)return!0;if(n(i.children))return!0}return!1};for(const e of this._board.columns)if(n(e.tasks))return e}async _handleMove(e,n,t="bottom",i){if(this._activeFileUri)try{const o=await r.workspace.fs.readFile(this._activeFileUri);let s=Buffer.from(o).toString("utf-8");s=(0,l.moveTaskInContent)(s,e,n,t,i),await r.workspace.fs.writeFile(this._activeFileUri,Buffer.from(s,"utf-8"))}catch(e){console.error("Error moving task:",e)}}async _handleMoveToParent(e,n,t="bottom",i){if(this._activeFileUri)try{const o=await r.workspace.fs.readFile(this._activeFileUri);let s=Buffer.from(o).toString("utf-8");s=(0,l.moveTaskToParent)(s,e,n,t,i),await r.workspace.fs.writeFile(this._activeFileUri,Buffer.from(s,"utf-8"))}catch(e){console.error("Error moving task to parent:",e)}}async _handleOpenAtLine(e){if(this._activeFileUri)try{const n=await r.workspace.openTextDocument(this._activeFileUri),t=await r.window.showTextDocument(n),i=new r.Position(e-1,0);t.selection=new r.Selection(i,i),t.revealRange(new r.Range(i,i),r.TextEditorRevealType.InCenter)}catch(e){console.error("Error opening file at line:",e)}}async _handleAddTask(e){if(this._activeFileUri)try{const n=await r.workspace.fs.readFile(this._activeFileUri),t=Buffer.from(n).toString("utf-8"),i=(0,l.addTaskToSection)(t,e);i.line>0&&(this._pendingEditLine=i.line,await r.workspace.fs.writeFile(this._activeFileUri,Buffer.from(i.content,"utf-8")))}catch(e){console.error("Error adding task:",e)}}async _handleEditTaskText(e,n){if(this._activeFileUri)try{const t=await r.workspace.fs.readFile(this._activeFileUri);let i=Buffer.from(t).toString("utf-8");i=(0,l.editTaskTextInContent)(i,e,n),await r.workspace.fs.writeFile(this._activeFileUri,Buffer.from(i,"utf-8"))}catch(e){console.error("Error editing task text:",e)}}async _handleAddSubtask(e){if(this._activeFileUri)try{const n=await r.workspace.fs.readFile(this._activeFileUri),t=Buffer.from(n).toString("utf-8"),i=(0,l.addSubtaskToParent)(t,e);i.line>0&&(this._pendingEditLine=i.line,await r.workspace.fs.writeFile(this._activeFileUri,Buffer.from(i.content,"utf-8")))}catch(e){console.error("Error adding subtask:",e)}}_getHtmlForWebview(e){const n=function(){let e="";const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let t=0;t<32;t++)e+=n.charAt(Math.floor(62*Math.random()));return e}();return`<!DOCTYPE html>\n<html lang="en">\n<head>\n  <meta charset="UTF-8">\n  <meta http-equiv="Content-Security-Policy" content="default-src 'none'; style-src ${e.cspSource} 'unsafe-inline'; script-src 'nonce-${n}' https://cdn.jsdelivr.net;">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <title>Kanban Board</title>\n  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"><\/script>\n  <style>\n    body {\n      padding: 8px;\n      font-family: var(--vscode-font-family);\n      font-size: var(--vscode-font-size);\n      color: var(--vscode-foreground);\n      background: var(--vscode-sideBar-background);\n    }\n    .no-file {\n      text-align: center;\n      padding: 20px;\n      color: var(--vscode-descriptionForeground);\n    }\n    .board {\n      display: flex;\n      flex-direction: column;\n      gap: 16px;\n    }\n    .board-header {\n      margin-bottom: 8px;\n    }\n    .board-title {\n      font-size: 1.2em;\n      font-weight: bold;\n      margin: 0 0 4px 0;\n    }\n    .board-description {\n      font-size: 0.9em;\n      color: var(--vscode-descriptionForeground);\n      margin: 0;\n    }\n    .column {\n      background: var(--vscode-editor-background);\n      border: 1px solid var(--vscode-panel-border);\n      border-radius: 4px;\n      padding: 8px;\n    }\n    .column-header {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      font-weight: bold;\n      margin-bottom: 8px;\n      padding-bottom: 4px;\n      border-bottom: 1px solid var(--vscode-panel-border);\n    }\n    .add-task-btn {\n      background: none;\n      border: none;\n      color: var(--vscode-foreground);\n      cursor: pointer;\n      font-size: 1.2em;\n      opacity: 0.5;\n      padding: 0 4px;\n      line-height: 1;\n    }\n    .add-task-btn:hover {\n      opacity: 1;\n    }\n    .task-edit-input {\n      flex: 1;\n      background: var(--vscode-input-background);\n      border: 1px solid var(--vscode-focusBorder);\n      color: var(--vscode-foreground);\n      font-family: inherit;\n      font-size: inherit;\n      padding: 2px 4px;\n      border-radius: 2px;\n      min-width: 0;\n    }\n    .task-edit-input:focus {\n      outline: none;\n      border-color: var(--vscode-focusBorder);\n    }\n    .column.drag-over {\n      background: var(--vscode-list-hoverBackground);\n    }\n    .task {\n      background: var(--vscode-input-background);\n      border: 1px solid var(--vscode-input-border);\n      border-radius: 3px;\n      padding: 6px 8px;\n      margin-bottom: 6px;\n      cursor: grab;\n    }\n    .task:last-child {\n      margin-bottom: 0;\n    }\n    .task.dragging {\n      opacity: 0.5;\n    }\n    .task-header {\n      display: flex;\n      align-items: flex-start;\n      gap: 6px;\n    }\n    .task-checkbox {\n      margin-top: 2px;\n      cursor: pointer;\n    }\n    .task-text {\n      flex: 1;\n      word-break: break-word;\n    }\n    .task-text.checked {\n      text-decoration: line-through;\n      opacity: 0.7;\n    }\n    .task-actions {\n      display: flex;\n      flex-shrink: 0;\n      gap: 2px;\n    }\n    .open-btn, .add-subtask-btn {\n      background: none;\n      border: none;\n      color: var(--vscode-textLink-foreground);\n      cursor: pointer;\n      padding: 2px 4px;\n      font-size: 14px;\n      line-height: 1;\n      opacity: 0.7;\n    }\n    .open-btn:hover, .add-subtask-btn:hover {\n      opacity: 1;\n    }\n    .children {\n      margin-left: 20px;\n      margin-top: 4px;\n      min-height: 10px;\n      font-size: 0.9em;\n      color: var(--vscode-descriptionForeground);\n    }\n    .child-task {\n      background: var(--vscode-input-background);\n      border: 1px solid var(--vscode-input-border);\n      border-radius: 3px;\n      padding: 4px 6px;\n      margin: 4px 0;\n      cursor: grab;\n      font-size: 0.9em;\n    }\n    .child-task .task-header {\n      display: flex;\n      align-items: flex-start;\n      gap: 4px;\n    }\n    .child-task .task-checkbox {\n      margin-top: 1px;\n    }\n    .child-task .open-btn {\n      font-size: 0.8em;\n      padding: 1px 3px;\n    }\n    .child-task.task-ghost {\n      opacity: 0.4;\n      background: var(--vscode-list-activeSelectionBackground);\n      border: 2px dashed var(--vscode-focusBorder);\n    }\n    /* SortableJS styles */\n    .task-ghost {\n      opacity: 0.4;\n      background: var(--vscode-list-activeSelectionBackground);\n      border: 2px dashed var(--vscode-focusBorder);\n    }\n    .task-chosen {\n      background: var(--vscode-list-activeSelectionBackground);\n      border-color: var(--vscode-focusBorder);\n    }\n    .task-drag {\n      opacity: 1;\n      background: var(--vscode-list-activeSelectionBackground);\n    }\n    .tasks {\n      min-height: 20px;\n    }\n    .sortable-placeholder {\n      height: 40px;\n      background: var(--vscode-list-hoverBackground);\n      border: 2px dashed var(--vscode-focusBorder);\n      border-radius: 3px;\n      margin-bottom: 6px;\n    }\n    /* Column picker modal */\n    .column-picker-overlay {\n      position: fixed;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      background: rgba(0, 0, 0, 0.5);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      z-index: 1000;\n    }\n    .column-picker {\n      background: var(--vscode-editor-background);\n      border: 1px solid var(--vscode-panel-border);\n      border-radius: 6px;\n      padding: 12px;\n      min-width: 200px;\n      max-width: 300px;\n    }\n    .column-picker-title {\n      font-weight: bold;\n      margin-bottom: 10px;\n      padding-bottom: 8px;\n      border-bottom: 1px solid var(--vscode-panel-border);\n    }\n    .column-picker-option {\n      display: block;\n      width: 100%;\n      padding: 8px 12px;\n      margin: 4px 0;\n      background: var(--vscode-input-background);\n      border: 1px solid var(--vscode-input-border);\n      border-radius: 3px;\n      color: var(--vscode-foreground);\n      cursor: pointer;\n      text-align: left;\n    }\n    .column-picker-option:hover {\n      background: var(--vscode-list-hoverBackground);\n      border-color: var(--vscode-focusBorder);\n    }\n    .column-picker-cancel {\n      display: block;\n      width: 100%;\n      padding: 8px 12px;\n      margin-top: 8px;\n      background: transparent;\n      border: 1px solid var(--vscode-input-border);\n      border-radius: 3px;\n      color: var(--vscode-descriptionForeground);\n      cursor: pointer;\n      text-align: center;\n    }\n    .column-picker-cancel:hover {\n      background: var(--vscode-list-hoverBackground);\n    }\n  </style>\n</head>\n<body>\n  <div id="content">\n    <div class="no-file">\n      Open a markdown file to view your todo board.<br>\n      Use the command "Todo Sidebar: Open Markdown File"\n    </div>\n  </div>\n\n  <script nonce="${n}">\n    const vscode = acquireVsCodeApi();\n    let board = null;\n\n    function renderChildTask(child, isDoneColumn) {\n      const grandchildren = child.children.map(c => renderChildTask(c, isDoneColumn)).join('');\n      return \`\n        <div class="child-task" draggable="true" data-line="\${child.line}" data-in-done="\${isDoneColumn}">\n          <div class="task-header">\n            <input type="checkbox" class="task-checkbox" \${child.checked ? 'checked' : ''} data-line="\${child.line}" data-in-done="\${isDoneColumn}">\n            <span class="task-text \${child.checked ? 'checked' : ''}">\${escapeHtml(child.text)}</span>\n            <div class="task-actions">\n              <button class="add-subtask-btn" data-line="\${child.line}" title="Add subtask">+</button>\n              <button class="open-btn" data-line="\${child.line}" title="Open in editor">↗</button>\n            </div>\n          </div>\n          \${grandchildren ? '<div class="children" data-parent-line="' + child.line + '">' + grandchildren + '</div>' : ''}\n        </div>\n      \`;\n    }\n\n    function renderTask(task, isDoneColumn = false) {\n      const children = task.children.map(child => renderChildTask(child, isDoneColumn)).join('');\n\n      return \`\n        <div class="task" draggable="true" data-line="\${task.line}" data-in-done="\${isDoneColumn}">\n          <div class="task-header">\n            <input type="checkbox" class="task-checkbox" \${task.checked ? 'checked' : ''} data-line="\${task.line}" data-in-done="\${isDoneColumn}">\n            <span class="task-text \${task.checked ? 'checked' : ''}">\${escapeHtml(task.text)}</span>\n            <div class="task-actions">\n              <button class="add-subtask-btn" data-line="\${task.line}" title="Add subtask">+</button>\n              <button class="open-btn" data-line="\${task.line}" title="Open in editor">↗</button>\n            </div>\n          </div>\n          <div class="children" data-parent-line="\${task.line}">\${children}</div>\n        </div>\n      \`;\n    }\n\n    function renderColumn(column) {\n      const tasks = column.tasks.map(task => renderTask(task, column.isDoneColumn)).join('');\n      return \`\n        <div class="column" data-section="\${escapeHtml(column.title)}" data-is-done="\${column.isDoneColumn}">\n          <div class="column-header">\n            <span class="column-title">\${escapeHtml(column.title)}</span>\n            <button class="add-task-btn" data-section="\${escapeHtml(column.title)}" title="Add task">+</button>\n          </div>\n          <div class="tasks" data-section="\${escapeHtml(column.title)}">\${tasks}</div>\n        </div>\n      \`;\n    }\n\n    function renderBoard(board) {\n      if (!board || !board.columns || board.columns.length === 0) {\n        return '<div class="no-file">No columns found in the markdown file.</div>';\n      }\n\n      const columns = board.columns.map(col => renderColumn(col)).join('');\n      return \`\n        <div class="board-header">\n          \${board.title ? '<h2 class="board-title">' + escapeHtml(board.title) + '</h2>' : ''}\n          \${board.description ? '<p class="board-description">' + escapeHtml(board.description) + '</p>' : ''}\n        </div>\n        <div class="board">\${columns}</div>\n      \`;\n    }\n\n    function escapeHtml(text) {\n      const div = document.createElement('div');\n      div.textContent = text;\n      return div.innerHTML;\n    }\n\n    function updateUI() {\n      document.getElementById('content').innerHTML = renderBoard(board);\n      setupEventListeners();\n    }\n\n    function showColumnPicker(columns, taskLine) {\n      // Filter out the Done column - user shouldn't move back to Done\n      const availableColumns = columns.filter(c => !c.isDoneColumn);\n\n      const overlay = document.createElement('div');\n      overlay.className = 'column-picker-overlay';\n      overlay.innerHTML = \`\n        <div class="column-picker">\n          <div class="column-picker-title">Move task to:</div>\n          \${availableColumns.map(c => \`\n            <button class="column-picker-option" data-column="\${escapeHtml(c.title)}">\${escapeHtml(c.title)}</button>\n          \`).join('')}\n          <button class="column-picker-cancel">Cancel</button>\n        </div>\n      \`;\n\n      overlay.addEventListener('click', (e) => {\n        if (e.target.classList.contains('column-picker-option')) {\n          const targetColumn = e.target.dataset.column;\n          vscode.postMessage({ type: 'toggle', line: taskLine, checked: false, targetColumn });\n          overlay.remove();\n        } else if (e.target.classList.contains('column-picker-cancel') || e.target === overlay) {\n          // Cancel - revert the checkbox\n          const checkbox = document.querySelector(\`.task-checkbox[data-line="\${taskLine}"]\`);\n          if (checkbox) checkbox.checked = true;\n          overlay.remove();\n        }\n      });\n\n      document.body.appendChild(overlay);\n    }\n\n    function enterEditMode(taskElement) {\n      const textSpan = taskElement.querySelector('.task-text');\n      if (!textSpan || taskElement.querySelector('.task-edit-input')) {\n        return; // Already in edit mode\n      }\n\n      const line = parseInt(taskElement.dataset.line);\n      const originalText = textSpan.textContent;\n\n      const input = document.createElement('input');\n      input.type = 'text';\n      input.className = 'task-edit-input';\n      input.value = originalText;\n      input.dataset.line = line;\n      input.dataset.originalText = originalText;\n\n      textSpan.replaceWith(input);\n      input.focus();\n      input.select();\n\n      input.addEventListener('keydown', handleEditKeydown);\n      input.addEventListener('blur', handleEditBlur);\n    }\n\n    function handleEditKeydown(e) {\n      if (e.key === 'Enter') {\n        e.preventDefault();\n        saveEdit(e.target);\n      } else if (e.key === 'Escape') {\n        e.preventDefault();\n        cancelEdit(e.target);\n      }\n    }\n\n    function handleEditBlur(e) {\n      // Small delay to allow cancel via Escape\n      setTimeout(() => {\n        if (document.body.contains(e.target)) {\n          saveEdit(e.target);\n        }\n      }, 0);\n    }\n\n    function saveEdit(input) {\n      const line = parseInt(input.dataset.line);\n      const newText = input.value.trim();\n      const originalText = input.dataset.originalText;\n\n      if (newText && newText !== originalText) {\n        vscode.postMessage({ type: 'editTaskText', line, newText });\n      }\n      // Restore span (UI will fully refresh from file watcher)\n      restoreTextSpan(input, newText || originalText);\n    }\n\n    function cancelEdit(input) {\n      const originalText = input.dataset.originalText;\n      restoreTextSpan(input, originalText);\n    }\n\n    function restoreTextSpan(input, text) {\n      const span = document.createElement('span');\n      span.className = 'task-text';\n      span.textContent = text;\n      input.replaceWith(span);\n    }\n\n    function setupEventListeners() {\n      // Checkboxes\n      document.querySelectorAll('.task-checkbox').forEach(checkbox => {\n        checkbox.addEventListener('change', (e) => {\n          const line = parseInt(e.target.dataset.line);\n          const checked = e.target.checked;\n          const inDone = e.target.dataset.inDone === 'true';\n\n          if (!checked && inDone) {\n            // Unchecking in Done column - show column picker\n            pendingUncheckLine = line;\n            vscode.postMessage({ type: 'getColumns', line });\n          } else {\n            // Normal toggle\n            vscode.postMessage({ type: 'toggle', line, checked });\n          }\n        });\n      });\n\n      // Open buttons\n      document.querySelectorAll('.open-btn').forEach(btn => {\n        btn.addEventListener('click', (e) => {\n          const line = parseInt(e.target.dataset.line);\n          vscode.postMessage({ type: 'openAtLine', line });\n        });\n      });\n\n      // Add task buttons\n      document.querySelectorAll('.add-task-btn').forEach(btn => {\n        btn.addEventListener('click', (e) => {\n          e.stopPropagation();\n          const section = e.target.dataset.section;\n          vscode.postMessage({ type: 'addTask', section });\n        });\n      });\n\n      // Add subtask buttons\n      document.querySelectorAll('.add-subtask-btn').forEach(btn => {\n        btn.addEventListener('click', (e) => {\n          e.stopPropagation();\n          const parentLine = parseInt(e.target.dataset.line);\n          vscode.postMessage({ type: 'addSubtask', parentLine });\n        });\n      });\n\n      // Double-click to edit - listen on task container, not just text\n      document.querySelectorAll('.task, .child-task').forEach(taskElement => {\n        taskElement.addEventListener('dblclick', (e) => {\n          // Don't trigger if clicking on buttons or checkbox\n          if (e.target.closest('button, input')) {\n            return;\n          }\n          e.stopPropagation();\n          enterEditMode(taskElement);\n        });\n      });\n\n      // SortableJS for column-level tasks\n      document.querySelectorAll('.tasks').forEach(taskList => {\n        new Sortable(taskList, {\n          group: 'shared',\n          animation: 150,\n          ghostClass: 'task-ghost',\n          chosenClass: 'task-chosen',\n          dragClass: 'task-drag',\n          onEnd: (evt) => {\n            const taskLine = parseInt(evt.item.dataset.line);\n            const targetSection = evt.to.dataset.section;\n            const targetParentLine = evt.to.dataset.parentLine;\n            const newIndex = evt.newIndex;\n\n            if (targetParentLine) {\n              // Dropped into a parent task's children area\n              const prevSibling = evt.item.previousElementSibling;\n              const afterLine = prevSibling ? parseInt(prevSibling.dataset.line) : undefined;\n              vscode.postMessage({\n                type: 'moveToParent',\n                taskLine,\n                parentLine: parseInt(targetParentLine),\n                position: newIndex === 0 ? 'top' : 'after',\n                afterLine\n              });\n            } else if (targetSection) {\n              // Dropped into a column - find what we're after\n              const prevSibling = evt.item.previousElementSibling;\n              if (newIndex === 0 || !prevSibling) {\n                vscode.postMessage({ type: 'move', taskLine, targetSection, position: 'top' });\n              } else {\n                const afterLine = parseInt(prevSibling.dataset.line);\n                vscode.postMessage({ type: 'move', taskLine, targetSection, position: 'after', afterLine });\n              }\n            }\n          }\n        });\n      });\n\n      // SortableJS for child tasks within parent tasks\n      document.querySelectorAll('.children').forEach(childList => {\n        new Sortable(childList, {\n          group: 'shared',\n          animation: 150,\n          ghostClass: 'task-ghost',\n          chosenClass: 'task-chosen',\n          dragClass: 'task-drag',\n          onEnd: (evt) => {\n            const taskLine = parseInt(evt.item.dataset.line);\n            const targetSection = evt.to.dataset.section;\n            const targetParentLine = evt.to.dataset.parentLine;\n            const newIndex = evt.newIndex;\n\n            if (targetParentLine) {\n              // Dropped into a parent task's children area\n              const prevSibling = evt.item.previousElementSibling;\n              const afterLine = prevSibling ? parseInt(prevSibling.dataset.line) : undefined;\n              vscode.postMessage({\n                type: 'moveToParent',\n                taskLine,\n                parentLine: parseInt(targetParentLine),\n                position: newIndex === 0 ? 'top' : 'after',\n                afterLine\n              });\n            } else if (targetSection) {\n              // Promoted to column level (dragged out of parent)\n              const prevSibling = evt.item.previousElementSibling;\n              if (newIndex === 0 || !prevSibling) {\n                vscode.postMessage({ type: 'move', taskLine, targetSection, position: 'top' });\n              } else {\n                const afterLine = parseInt(prevSibling.dataset.line);\n                vscode.postMessage({ type: 'move', taskLine, targetSection, position: 'after', afterLine });\n              }\n            }\n          }\n        });\n      });\n    }\n\n    // Handle messages from extension\n    window.addEventListener('message', (event) => {\n      const message = event.data;\n      if (message.type === 'update') {\n        board = message.board;\n        updateUI();\n        // Enter edit mode on newly added task if specified\n        if (message.editLine) {\n          const taskElement = document.querySelector(\`[data-line="\${message.editLine}"]\`);\n          if (taskElement) {\n            enterEditMode(taskElement);\n          }\n        }\n      } else if (message.type === 'columnsForPicker') {\n        showColumnPicker(message.columns, message.taskLine);\n      }\n    });\n  <\/script>\n</body>\n</html>`}dispose(){for(const e of this._disposables)e.dispose()}}}},n={},t=function t(i){var o=n[i];if(void 0!==o)return o.exports;var s=n[i]={exports:{}};return e[i].call(s.exports,s,s.exports,t),s.exports}(265);module.exports=t})();