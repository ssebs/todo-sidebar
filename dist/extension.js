(()=>{"use strict";var e={265(e,t,i){var s,n=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i);var n=Object.getOwnPropertyDescriptor(t,i);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,s,n)}:function(e,t,i,s){void 0===s&&(s=i),e[s]=t[i]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||(s=function(e){return s=Object.getOwnPropertyNames||function(e){var t=[];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[t.length]=i);return t},s(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i=s(e),r=0;r<i.length;r++)"default"!==i[r]&&n(t,e,i[r]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.activate=function(e){console.log("Todo Sidebar extension is now active!"),l=new c.KanbanViewProvider(e),e.subscriptions.push(a.window.registerWebviewViewProvider(c.KanbanViewProvider.viewType,l));const t=a.commands.registerCommand("todoSidebar.openFile",async()=>{const e=await a.window.showOpenDialog({canSelectFiles:!0,canSelectFolders:!1,canSelectMany:!1,filters:{Markdown:["md"]},title:"Select a Markdown file for the Todo Board"});e&&e[0]&&(await l.setActiveFile(e[0]),a.window.showInformationMessage(`Loaded: ${e[0].fsPath}`))}),i=a.commands.registerCommand("todoSidebar.refresh",async()=>{await l.refresh()});e.subscriptions.push(t,i)},t.deactivate=function(){l&&l.dispose()};const a=r(i(398)),c=i(913);let l},337(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.parseMarkdown=function(e){const t=e.replace(/\r\n/g,"\n").replace(/\r/g,"\n").split("\n"),h={title:"",description:"",columns:[]};let d=null,f=[],u=!1;for(let e=0;e<t.length;e++){const w=t[e],g=e+1;if(!u){const e=w.match(i);if(e){h.title=e[1].trim();continue}const t=w.match(s);if(t){h.description?h.description+="\n"+t[1]:h.description=t[1];continue}}const p=w.match(n);if(p){u=!0;const e=p[1].trim();d={title:e,description:"",line:g,isDoneColumn:e.toLowerCase().includes("done"),tasks:[]},h.columns.push(d),f=[];continue}if(d&&0===d.tasks.length){const e=w.match(s);if(e){d.description?d.description+="\n"+e[1]:d.description=e[1];continue}}const _=w.match(o);if(_&&d){const e=_[1].length,t="x"===_[2].toLowerCase(),i={text:_[3].trim(),checked:t,line:g,children:[],hasCheckbox:!0};for(;f.length>0&&f[f.length-1].indent>=e;)f.pop();f.length>0?f[f.length-1].task.children.push(i):d.tasks.push(i),f.push({task:i,indent:e});continue}const v=w.match(r);if(v&&d){const e=v[1].length,t=v[2],i="☑"===t||"✓"===t,s={text:v[3].trim(),checked:i,line:g,children:[],hasCheckbox:!0};for(;f.length>0&&f[f.length-1].indent>=e;)f.pop();f.length>0?f[f.length-1].task.children.push(s):d.tasks.push(s),f.push({task:s,indent:e});continue}const m=w.match(a);if(m&&f.length>0){const e={text:m[2].trim(),checked:!1,line:g,children:[],hasCheckbox:!1};f[f.length-1].task.children.push(e);continue}const k=w.match(c);if(k&&f.length>0){const e=k[1].length,t=k[2].trim();if(t.match(l))continue;const i={text:t,checked:!1,line:g,children:[],hasCheckbox:!1};for(;f.length>1&&f[f.length-1].indent>=e;)f.pop();f.length>0&&f[f.length-1].task.children.push(i)}}return h};const i=/^#\s+([^#].*)$/,s=/^>\s*(.*)$/,n=/^##\s+(.+)$/,o=/^(\s*)[-*]\s+\[([ xX])\]\s+(.+)$/,r=/^(\s*)[-*]\s+([☐☑✓✗])\s+(.+)$/,a=/^(\s*)[-*]\s+>\s*(.+)$/,c=/^(\s+)[-*]\s+(.+)$/,l=/^\[[ xX]\]|^[☐☑✓✗]/},398(e){e.exports=require("vscode")},522(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.toggleTaskInContent=function(e,t,i){const{lines:a,lineEnding:c}=d(e),l=t-1;if(l>=0&&l<a.length){const e=a[l];if(i){let t=e.replace(s,"$1[x]");t=t.replace(o,"$1☑"),a[l]=t}else{let t=e.replace(n,"$1[ ]");t=t.replace(r,"$1☐"),a[l]=t}}return a.join(c)},t.moveTaskInContent=function(e,t,s,n="bottom",o){const{lines:r,lineEnding:a}=d(e),c=t-1,l=[],f=r[c]?.match(i)?.[1].length??0;l.push(r[c]);let u=c+1;for(;u<r.length;){const e=r[u],t=e.match(i)?.[1].length??0;if(""===e.trim())break;if(t<=f&&""!==e.trim())break;l.push(e),u++}const w=l.map(e=>e.startsWith(" ".repeat(f))?e.slice(f):e),g=[...r.slice(0,c),...r.slice(c+l.length)];let p=-1,_=o;void 0!==o&&t<o&&(_=o-l.length);for(let e=0;e<g.length;e++){const t=g[e].match(h);if(t){const o=t[1].trim();if(o===s||o.startsWith(s)){if("top"===n){let t=e+1;for(;t<g.length&&""===g[t].trim();)t++;p=t}else if("after"===n&&void 0!==_){const e=_-1;if(e>=0&&e<g.length){const t=g[e]?.match(i)?.[1].length??0;let s=e+1;for(;s<g.length;){const e=g[s],n=e.match(i)?.[1].length??0;if(""===e.trim()||n<=t)break;s++}p=s}}else{let t=e+1;for(;t<g.length&&!g[t].match(h);)t++;p=t}break}}}if(-1===p)return e;const v=[...g.slice(0,p),...w,"",...g.slice(p)],m=[];let k=!1;for(const e of v){const t=""===e.trim();t&&k||(m.push(e),k=t)}return m.join(a)},t.moveTaskToParent=function(e,t,s,n="bottom",o){const{lines:r,lineEnding:c}=d(e),l=t-1,h=s-1;if(t===s)return e;if(function(e,t,s){const n=s-1,o=t-1;if(n<0||n>=e.length)return!1;if(o<0||o>=e.length)return!1;const r=e[n]?.match(i)?.[1].length??0;let a=n+1;for(;a<e.length;){const t=e[a],s=t.match(i)?.[1].length??0;if(""!==t.trim()&&s<=r)break;if(a===o)return!0;a++}return!1}(r,s,t))return e;const f=r[l];if(!f)return e;const u=f.match(a);if(!u)return e;const w=u[1]||"[ ]",g=u[2],p=r[h];if(!p)return e;const _=p.match(i)?.[1].length??0,v=" ".repeat(_+2),m=[],k=f.match(i)?.[1].length??0;m.push(`${v}- ${w} ${g}`);let b=l+1;for(;b<r.length;){const e=r[b],t=e.match(i)?.[1].length??0;if(""===e.trim())break;if(t<=k&&""!==e.trim())break;const s=e.match(/^(\s*)(.+)$/);if(s){const e=" ".repeat(_+2+(t-k));m.push(`${e}${s[2]}`)}b++}const F=b-l;let y=h;l<h&&(y=h-F);const S=[...r.slice(0,l),...r.slice(l+F)];let T;const x=S[y],P=x?.match(i)?.[1].length??0;if("top"===n)T=y+1;else if("after"===n&&void 0!==o){let e=o;l<o&&(e=o-F);const t=e-1;if(t>=0&&t<S.length){const e=S[t]?.match(i)?.[1].length??0;for(T=t+1;T<S.length;){const t=S[T],s=t.match(i)?.[1].length??0;if(""===t.trim()||s<=e)break;T++}}else T=y+1}else for(T=y+1;T<S.length;){const e=S[T],t=e.match(i)?.[1].length??0;if(""===e.trim())break;if(t<=P)break;T++}const U=[...S.slice(0,T),...m,...S.slice(T)],C=[];let $=!1;for(const e of U){const t=""===e.trim();t&&$||(C.push(e),$=t)}return C.join(c)},t.addTaskToSection=function(e,t){const{lines:i,lineEnding:s}=d(e);let n=-1;for(let e=0;e<i.length;e++){const s=i[e].match(h);if(s&&s[1].trim()===t){n=e;break}}if(-1===n)return{content:e,line:-1};let o=n+1;for(;o<i.length&&""===i[o].trim();)o++;return i.splice(o,0,"- [ ] New task"),{content:i.join(s),line:o+1}},t.editTaskTextInContent=function(e,t,i){const{lines:s,lineEnding:n}=d(e),o=t-1;if(o<0||o>=s.length)return e;const r=s[o],a=r.match(c);if(a)return s[o]=a[1]+i,s.join(n);const h=r.match(l);return h?(s[o]=h[1]+i,s.join(n)):e},t.addSubtaskToParent=function(e,t){const{lines:s,lineEnding:n}=d(e),o=t-1;if(o<0||o>=s.length)return{content:e,line:-1};const r=s[o],a=r.match(i)?.[1].length??0,c=" ".repeat(a+2);let l=o+1;for(;l<s.length;){const e=s[l],t=e.match(i)?.[1].length??0;if(""===e.trim())break;if(t<=a)break;l++}const h=`${c}- [ ] New task`;return s.splice(l,0,h),{content:s.join(n),line:l+1}},t.removeCheckboxFromTask=function(e,t){const{lines:i,lineEnding:s}=d(e),n=t-1;if(n<0||n>=i.length)return e;const o=i[n],r=o.match(/^(\s*[-*]\s+)\[[ xX]\]\s+(.+)$/);if(r)return i[n]=r[1]+r[2],i.join(s);const a=o.match(/^(\s*[-*]\s+)[☐☑✓✗]\s+(.+)$/);return a?(i[n]=a[1]+a[2],i.join(s)):e},t.deleteTaskInContent=function(e,t){const{lines:s,lineEnding:n}=d(e),o=t-1;if(o<0||o>=s.length)return e;const r=s[o]?.match(i)?.[1].length??0;let a=1,c=o+1;for(;c<s.length;){const e=s[c],t=e.match(i)?.[1].length??0;if(""===e.trim())break;if(t<=r&&""!==e.trim())break;a++,c++}s.splice(o,a);const l=[];let h=!1;for(const e of s){const t=""===e.trim();t&&h||(l.push(e),h=t)}return l.join(n)};const i=/^(\s*)/,s=/([-*]\s+)\[ \]/,n=/([-*]\s+)\[[xX]\]/,o=/([-*]\s+)☐/,r=/([-*]\s+)[☑✓]/,a=/^\s*[-*]\s+(\[[ xX]\]|[☐☑✓✗])?\s*(.+)$/,c=/^(\s*[-*]\s+\[[ xX]\]\s+)(.+)$/,l=/^(\s*[-*]\s+[☐☑✓✗]\s+)(.+)$/,h=/^##\s+(.+)$/;function d(e){const t=e.includes("\r\n")?"\r\n":"\n";return{lines:e.split(/\r?\n/),lineEnding:t}}},896(e){e.exports=require("fs")},913(e,t,i){var s,n=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i);var n=Object.getOwnPropertyDescriptor(t,i);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,s,n)}:function(e,t,i,s){void 0===s&&(s=i),e[s]=t[i]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||(s=function(e){return s=Object.getOwnPropertyNames||function(e){var t=[];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[t.length]=i);return t},s(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i=s(e),r=0;r<i.length;r++)"default"!==i[r]&&n(t,e,i[r]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.KanbanViewProvider=void 0;const a=r(i(398)),c=r(i(928)),l=r(i(896)),h=i(337),d=i(522);function f(){let e="";for(let t=0;t<32;t++)e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return e}t.KanbanViewProvider=class{_context;static viewType="todoSidebar.kanbanView";_view;_activeFileUri;_board;_disposables=[];_pendingEditLine;_historyStack=[];_historyIndex=-1;_maxHistorySize=50;_isUndoRedo=!1;_periodicRefreshTimer;_periodicRefreshInterval=5e3;constructor(e){this._context=e}resolveWebviewView(e,t,i){this._view=e,e.webview.options={enableScripts:!0,localResourceRoots:[this._context.extensionUri]},e.onDidChangeVisibility(()=>{e.visible&&this._activeFileUri?(this._refresh(),this._startPeriodicRefresh()):this._stopPeriodicRefresh()}),e.webview.onDidReceiveMessage(async e=>{switch(e.type){case"toggle":await this._handleToggle(e.line,e.checked,e.targetColumn);break;case"move":await this._handleMove(e.taskLine,e.targetSection,e.position,e.afterLine);break;case"openAtLine":await this._handleOpenAtLine(e.line);break;case"getColumns":this._board&&this._view?.webview.postMessage({type:"columnsForPicker",columns:this._board.columns.map(e=>({title:e.title,isDoneColumn:e.isDoneColumn})),taskLine:e.line});break;case"moveToParent":await this._handleMoveToParent(e.taskLine,e.parentLine,e.position,e.afterLine);break;case"addTask":await this._handleAddTask(e.section);break;case"editTaskText":await this._handleEditTaskText(e.line,e.newText);break;case"addSubtask":await this._handleAddSubtask(e.parentLine);break;case"undo":await this._handleUndo();break;case"redo":await this._handleRedo();break;case"deleteTask":await this._handleDeleteTask(e.line);break;case"hideSection":await this._handleHideSection(e.sectionTitle);break;case"selectFile":await this._handleSelectFile();break;case"saveWizard":await this._handleSaveWizard(e.filePath,e.onDoneAction);break;case"cancelWizard":await this._handleCancelWizard()}}),0===this._disposables.length&&this._setupFileWatchers();const s=a.workspace.getConfiguration("todoSidebar").get("activeFile");if(console.log("Attempting to restore activeFile from settings:",s),s)try{if(s.startsWith("./")||s.startsWith("../")||!c.isAbsolute(s)){const e=a.workspace.workspaceFolders?.[0];e&&(this._activeFileUri=a.Uri.joinPath(e.uri,s))}else this._activeFileUri=a.Uri.file(s);this._activeFileUri&&console.log("Restored activeFile:",this._activeFileUri.fsPath)}catch(e){console.error("Failed to restore saved file:",e)}this._refresh(),this._activeFileUri&&this._startPeriodicRefresh()}_startPeriodicRefresh(){this._stopPeriodicRefresh(),this._view?.visible&&this._activeFileUri&&(this._periodicRefreshTimer=setInterval(()=>{this._view?.visible&&this._activeFileUri?this._refresh():this._stopPeriodicRefresh()},this._periodicRefreshInterval))}_stopPeriodicRefresh(){this._periodicRefreshTimer&&(clearInterval(this._periodicRefreshTimer),this._periodicRefreshTimer=void 0)}_setupFileWatchers(){this._disposables.push(a.workspace.onDidChangeTextDocument(e=>{this._activeFileUri&&e.document.uri.toString()===this._activeFileUri.toString()&&this._refresh()}));const e=a.workspace.createFileSystemWatcher("**/*.md");this._disposables.push(e.onDidChange(e=>{this._activeFileUri&&e.toString()===this._activeFileUri.toString()&&this._refresh()})),this._disposables.push(e);const t=a.workspace.createFileSystemWatcher("**/.vscode/settings.json");this._disposables.push(t.onDidChange(()=>{this._reloadActiveFileFromConfig()})),this._disposables.push(t),this._disposables.push(a.workspace.onDidChangeConfiguration(e=>{e.affectsConfiguration("todoSidebar.activeFile")&&this._reloadActiveFileFromConfig(),e.affectsConfiguration("todoSidebar.hiddenSections")&&this._refresh()}))}_reloadActiveFileFromConfig(){const e=a.workspace.getConfiguration("todoSidebar").get("activeFile");if(console.log("Config changed, reloading activeFile:",e),e)try{if(e.startsWith("./")||e.startsWith("../")||!c.isAbsolute(e)){const t=a.workspace.workspaceFolders?.[0];t&&(this._activeFileUri=a.Uri.joinPath(t.uri,e))}else this._activeFileUri=a.Uri.file(e);this._activeFileUri&&(console.log("Reloaded activeFile:",this._activeFileUri.fsPath),this._refresh())}catch(e){console.error("Failed to reload saved file:",e)}else this._activeFileUri=void 0,this._board=void 0,this._view?.webview.postMessage({type:"update",board:null})}async setActiveFile(e){this._activeFileUri=e,this._historyStack=[],this._historyIndex=-1,this._stopPeriodicRefresh();try{if(!(a.workspace.workspaceFolders&&a.workspace.workspaceFolders.length>0))return console.error("No workspace folder open - cannot save to workspace settings"),a.window.showWarningMessage("Please open a folder/workspace to persist the todo file selection"),void await this._refresh();const t=a.workspace.workspaceFolders[0],i=a.Uri.joinPath(t.uri,".vscode"),s=a.Uri.joinPath(i,"settings.json");try{await a.workspace.fs.stat(i)}catch{await a.workspace.fs.createDirectory(i),console.log("Created .vscode directory")}let n="",o=!1;try{const e=await a.workspace.fs.readFile(s);n=Buffer.from(e).toString("utf-8"),o=!0}catch(e){}let r=e.fsPath;if(t){const i=c.relative(t.uri.fsPath,e.fsPath);i.startsWith("..")||(r="./"+i.replace(/\\/g,"/"))}const l=JSON.stringify(r),h=/"todoSidebar\.activeFile"\s*:\s*"[^"]*"/,d=/"todoSidebar\.onDoneAction"\s*:\s*"[^"]*"/;let f;if(o&&""!==n.trim()){const e=h.test(n),t=d.test(n);if(e)f=n.replace(h,`"todoSidebar.activeFile": ${l}`);else{const e=n.match(/^\s*\{/);if(e){const t=e[0].length,i=n.slice(0,t),s=n.slice(t);f=i+`\n    "todoSidebar.activeFile": ${l}${s.trim().length>0&&"}"!==s.trim()?",":""}`+s}else f=`{\n    "todoSidebar.activeFile": ${l},\n    "todoSidebar.onDoneAction": "move"\n}`}if(!t){const e=f.match(/^\s*\{/);if(e){const t=e[0].length,i=f.slice(0,t),s=f.slice(t);f=i+'\n    "todoSidebar.onDoneAction": "move"'+(s.trim().length>0&&"}"!==s.trim()?",":"")+s}}}else f=`{\n    "todoSidebar.activeFile": ${l},\n    "todoSidebar.onDoneAction": "move"\n}`;await a.workspace.fs.writeFile(s,Buffer.from(f,"utf-8")),console.log("Saved activeFile to .vscode/settings.json:",e.fsPath)}catch(e){console.error("Failed to save activeFile to settings:",e),a.window.showErrorMessage(`Failed to save todo file selection: ${e}`)}await this._refresh(),this._startPeriodicRefresh()}async refresh(){await this._refresh()}async _readActiveFile(){if(!this._activeFileUri)return"";const e=await a.workspace.fs.readFile(this._activeFileUri);return Buffer.from(e).toString("utf-8")}async _writeActiveFile(e){this._activeFileUri&&(this._isUndoRedo||(this._historyIndex<this._historyStack.length-1&&(this._historyStack=this._historyStack.slice(0,this._historyIndex+1)),this._historyStack.push(e),this._historyStack.length>this._maxHistorySize?this._historyStack.shift():this._historyIndex++),await a.workspace.fs.writeFile(this._activeFileUri,Buffer.from(e,"utf-8")))}async _handleUndo(){if(this._historyIndex<=0||!this._activeFileUri)return;this._historyIndex--;const e=this._historyStack[this._historyIndex];this._isUndoRedo=!0;try{await a.workspace.fs.writeFile(this._activeFileUri,Buffer.from(e,"utf-8"))}finally{this._isUndoRedo=!1}}async _handleRedo(){if(this._historyIndex>=this._historyStack.length-1||!this._activeFileUri)return;this._historyIndex++;const e=this._historyStack[this._historyIndex];this._isUndoRedo=!0;try{await a.workspace.fs.writeFile(this._activeFileUri,Buffer.from(e,"utf-8"))}finally{this._isUndoRedo=!1}}async _refresh(){if(this._view)if(this._activeFileUri){this._view.webview.html.includes('id="content"')||(this._view.webview.html=this._getHtmlForWebview(this._view.webview));try{const e=await this._readActiveFile();0===this._historyStack.length&&(this._historyStack.push(e),this._historyIndex=0),this._board=(0,h.parseMarkdown)(e);const t=a.workspace.getConfiguration("todoSidebar").get("hiddenSections",[]),i={...this._board,columns:this._board.columns.filter(e=>!this._isColumnHidden(e.title,t))},s=this._pendingEditLine;this._pendingEditLine=void 0,this._view.webview.postMessage({type:"update",board:i,editLine:s})}catch(e){console.error("Error refreshing kanban board:",e)}}else this._view.webview.html=this._getWelcomeHtmlForWebview(this._view.webview)}async _handleToggle(e,t,i){if(this._activeFileUri)try{let s=await this._readActiveFile();const n=(0,h.parseMarkdown)(s),o=this._isTopLevelTaskInBoard(e,n),r=a.workspace.getConfiguration("todoSidebar").get("onDoneAction","move");if(t&&o)if("delete"===r)s=(0,d.deleteTaskInContent)(s,e);else{s=(0,d.toggleTaskInContent)(s,e,t);const i=n.columns.find(e=>e.isDoneColumn);if(i){const t=this._findTaskColumnInBoard(e,n);t&&!t.isDoneColumn&&(s=(0,d.moveTaskInContent)(s,e,i.title,"top"))}}else i&&o?(s=(0,d.toggleTaskInContent)(s,e,t),s=(0,d.moveTaskInContent)(s,e,i,"top")):s=(0,d.toggleTaskInContent)(s,e,t);await this._writeActiveFile(s)}catch(e){console.error("Error toggling task:",e)}}_isTopLevelTaskInBoard(e,t){for(const i of t.columns)for(const t of i.tasks)if(t.line===e)return!0;return!1}_findTaskColumnInBoard(e,t){const i=t=>{for(const s of t){if(s.line===e)return!0;if(i(s.children))return!0}return!1};for(const e of t.columns)if(i(e.tasks))return e}_isColumnHidden(e,t){const i=e.toLowerCase();for(const s of t){const t=s.toLowerCase();if(/[.+?^${}()|[\]\\]/.test(s))try{if(new RegExp(s,"i").test(e))return!0}catch(e){if(i===t)return!0}else if(t.includes("*")){const e="^"+t.replace(/\*/g,".*")+"$";if(new RegExp(e).test(i))return!0}else if(i===t)return!0}return!1}async _handleMove(e,t,i="bottom",s){if(this._activeFileUri)try{let n=await this._readActiveFile();n=(0,d.moveTaskInContent)(n,e,t,i,s),await this._writeActiveFile(n)}catch(e){console.error("Error moving task:",e)}}async _handleMoveToParent(e,t,i="bottom",s){if(this._activeFileUri)try{let n=await this._readActiveFile();n=(0,d.moveTaskToParent)(n,e,t,i,s),await this._writeActiveFile(n)}catch(e){console.error("Error moving task to parent:",e)}}async _handleOpenAtLine(e){if(this._activeFileUri)try{const t=await a.workspace.openTextDocument(this._activeFileUri),i=await a.window.showTextDocument(t),s=new a.Position(e-1,0);i.selection=new a.Selection(s,s),i.revealRange(new a.Range(s,s),a.TextEditorRevealType.InCenter)}catch(e){console.error("Error opening file at line:",e)}}async _handleAddTask(e){if(this._activeFileUri)try{const t=await this._readActiveFile(),i=(0,d.addTaskToSection)(t,e);i.line>0&&(this._pendingEditLine=i.line,await this._writeActiveFile(i.content))}catch(e){console.error("Error adding task:",e)}}async _handleEditTaskText(e,t){if(this._activeFileUri)try{let i=await this._readActiveFile();i=(0,d.editTaskTextInContent)(i,e,t),await this._writeActiveFile(i)}catch(e){console.error("Error editing task text:",e)}}async _handleAddSubtask(e){if(this._activeFileUri)try{const t=await this._readActiveFile(),i=(0,d.addSubtaskToParent)(t,e);i.line>0&&(this._pendingEditLine=i.line,await this._writeActiveFile(i.content))}catch(e){console.error("Error adding subtask:",e)}}async _handleDeleteTask(e){if(this._activeFileUri)try{let t=await this._readActiveFile();t=(0,d.deleteTaskInContent)(t,e),await this._writeActiveFile(t)}catch(e){console.error("Error deleting task:",e)}}async _handleHideSection(e){try{const t=a.workspace.getConfiguration("todoSidebar").get("hiddenSections",[]);if(!t.includes(e)){t.push(e);const i=a.workspace.workspaceFolders?.[0];if(!i)return void a.window.showWarningMessage("No workspace folder open - cannot save hidden sections");const s=a.Uri.joinPath(i.uri,".vscode"),n=a.Uri.joinPath(s,"settings.json");try{await a.workspace.fs.stat(s)}catch{await a.workspace.fs.createDirectory(s)}let o="",r=!1;try{const e=await a.workspace.fs.readFile(n);o=Buffer.from(e).toString("utf-8"),r=!0}catch(e){}const c=JSON.stringify(t),l=/"todoSidebar\.hiddenSections"\s*:\s*\[[^\]]*\]/;let h;if(r&&""!==o.trim())if(l.test(o))h=o.replace(l,`"todoSidebar.hiddenSections": ${c}`);else{const e=o.match(/^\s*\{/);if(e){const t=e[0].length,i=o.slice(0,t),s=o.slice(t);h=i+`\n    "todoSidebar.hiddenSections": ${c}${s.trim().length>0&&"}"!==s.trim()?",":""}`+s}else h=`{\n    "todoSidebar.hiddenSections": ${c}\n}`}else h=`{\n    "todoSidebar.hiddenSections": ${c}\n}`;await a.workspace.fs.writeFile(n,Buffer.from(h,"utf-8")),console.log("Added section to hiddenSections:",e),a.window.showInformationMessage(`Section "${e}" is now hidden. Edit settings to unhide.`)}}catch(e){console.error("Error hiding section:",e),a.window.showErrorMessage(`Failed to hide section: ${e}`)}}_getHtmlForWebview(e){const t=f(),i=c.join(this._context.extensionPath,"src","webview.html");let s=l.readFileSync(i,"utf-8");return s=s.replace(/\{\{cspSource\}\}/g,e.cspSource),s=s.replace(/\{\{nonce\}\}/g,t),s}_getWelcomeHtmlForWebview(e){const t=f(),i=c.join(this._context.extensionPath,"src","welcome.html");let s=l.readFileSync(i,"utf-8");const n=c.join(this._context.extensionPath,"src","tips.html"),o=l.readFileSync(n,"utf-8");return s=s.replace(/\{\{cspSource\}\}/g,e.cspSource),s=s.replace(/\{\{nonce\}\}/g,t),s=s.replace(/\{\{TIPS_CONTENT\}\}/g,o),s}async _handleSelectFile(){const e=await a.window.showOpenDialog({canSelectMany:!1,filters:{"Markdown files":["md","markdown"]},title:"Select a markdown file for your todo board"});e&&e[0]&&this._view?.webview.postMessage({type:"fileSelected",filePath:e[0].fsPath})}async _handleSaveWizard(e,t){try{const i=a.Uri.file(e);try{await a.workspace.fs.stat(i)}catch{return void this._view?.webview.postMessage({type:"error",message:"Selected file does not exist or is not accessible"})}const s=a.workspace.workspaceFolders?.[0];if(!s)return void a.window.showWarningMessage("Please open a folder/workspace to save settings");const n=a.Uri.joinPath(s.uri,".vscode"),o=a.Uri.joinPath(n,"settings.json");try{await a.workspace.fs.stat(n)}catch{await a.workspace.fs.createDirectory(n)}let r=e;const l=c.relative(s.uri.fsPath,e);l.startsWith("..")||(r="./"+l.replace(/\\/g,"/"));let h="",d=!1;try{const e=await a.workspace.fs.readFile(o);h=Buffer.from(e).toString("utf-8"),d=!0}catch(e){}const f=JSON.stringify(r),u=JSON.stringify(t);let w;if(d&&""!==h.trim()){const e=/"todoSidebar\.activeFile"\s*:\s*"[^"]*"/,t=/"todoSidebar\.onDoneAction"\s*:\s*"[^"]*"/,i=e.test(h),s=t.test(h);if(w=h,i)w=w.replace(e,`"todoSidebar.activeFile": ${f}`);else{const e=w.match(/^\s*\{/);if(e){const t=e[0].length,i=w.slice(0,t),s=w.slice(t);w=i+`\n    "todoSidebar.activeFile": ${f}${s.trim().length>0&&"}"!==s.trim()?",":""}`+s}}if(s)w=w.replace(t,`"todoSidebar.onDoneAction": ${u}`);else{const e=w.match(/^\s*\{/);if(e){const t=e[0].length,i=w.slice(0,t),s=w.slice(t);w=i+`\n    "todoSidebar.onDoneAction": ${u}${s.trim().length>0&&"}"!==s.trim()?",":""}`+s}}}else w=`{\n    "todoSidebar.activeFile": ${f},\n    "todoSidebar.onDoneAction": ${u}\n}`;await a.workspace.fs.writeFile(o,Buffer.from(w,"utf-8")),this._activeFileUri=i,this._historyStack=[],this._historyIndex=-1,this._view.webview.html=this._getHtmlForWebview(this._view.webview),await this._refresh(),this._startPeriodicRefresh(),a.window.showInformationMessage("Todo board setup complete!")}catch(e){console.error("Error saving wizard settings:",e),this._view?.webview.postMessage({type:"error",message:`Failed to save settings: ${e}`})}}async _handleCancelWizard(){a.window.showInformationMessage('You can open a markdown file anytime using the command "Todo Sidebar: Open Markdown File"')}dispose(){this._stopPeriodicRefresh();for(const e of this._disposables)e.dispose()}}},928(e){e.exports=require("path")}},t={},i=function i(s){var n=t[s];if(void 0!==n)return n.exports;var o=t[s]={exports:{}};return e[s].call(o.exports,o,o.exports,i),o.exports}(265);module.exports=i})();